<script>
  const alreadySeen = localStorage.getItem("hasSeenFoodSuggestion");
  const alreadyStarted = localStorage.getItem("hasStartedFoodSuggestion");

  if (alreadySeen || alreadyStarted) {
    document.body.innerHTML = `
      <h2>😋 You’ve already got your food suggestion!</h2>
      <p>Next time you're hungry, scan the code again!</p>
    `;
  }

  const foodOptions = {
    chinese: [
      "Char Kway Teow", "Hainanese Chicken Rice", "Bak Kut Teh", "Wantan Mee", "Claypot Yee Mee",
      "Pan Mee", "Yong Tau Foo", "Steamed Fish with Soy Sauce", "Sweet and Sour Pork", "Tomyam Mee",
      "Marmite Chicken", "Mala Fried Rice"
    ],
    malay: [
      "Nasi Lemak", "Nasi Kerabu", "Nasi Campur", "Ayam Masak Merah", "Sambal Sotong",
      "Mee Rebus", "Laksa Kedah", "Rendang Daging", "Lontong", "Ikan Bakar",
      "Sup Tulang", "Gulai Ayam"
    ],
    indian: [
      "Banana Leaf Rice", "Roti Canai with Dhal", "Chicken Briyani", "Thosai", "Mutton Curry",
      "Naan with Butter Chicken", "Masala Vadai", "Tandoori Chicken", "Palak Paneer", "Fish Head Curry",
      "Paneer Butter Masala", "Chapati with Kurma"
    ],
    western: [
      "Chicken Chop", "Spaghetti Bolognese", "Lamb Shoulder", "Fish and Chips", "Mac and Cheese",
      "Caesar Salad", "Cheeseburger", "Chicken Carbonara", "Mushroom Soup with Garlic Bread", "Steak with Black Pepper Sauce",
      "Grilled Salmon", "BBQ Ribs"
    ]
  };

  const shuffleDuration = 1500;
  const frameSpeed = 100;

  function startSuggestion() {
    const cuisine = document.getElementById("cuisineSelect").value;
    const box = document.getElementById("suggestion");
    const btn = document.getElementById("go");

    if (!cuisine) {
      alert("Please select a cuisine first.");
      return;
    }

    const selectedList = foodOptions[cuisine];
    btn.disabled = true;

    // 🔒 Mark as started (prevents refresh bypass)
    localStorage.setItem("hasStartedFoodSuggestion", "yes");

    let tick = 0;
    const interval = setInterval(() => {
      box.textContent = selectedList[tick % selectedList.length];
      tick++;
    }, frameSpeed);

    setTimeout(() => {
      clearInterval(interval);
      const result = selectedList[Math.floor(Math.random() * selectedList.length)];
      box.textContent = `🍽️ Try: ${result}`;
      btn.disabled = true;
      btn.textContent = "✅ Done";

      // 🔒 Mark as completed
      localStorage.setItem("hasSeenFoodSuggestion", "yes");
    }, shuffleDuration);
  }
</script>
