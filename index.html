<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>What to Eat?</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; background: #f5f5f5; }
    h1 { margin-bottom: 20px; }
    select, button {
      font-size: 16px;
      padding: 10px 16px;
      margin: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .box {
      min-height: 100px;
      font-size: 22px;
      padding: 20px 30px;
      border: 2px dashed #aaa;
      border-radius: 10px;
      background: #fff;
      display: inline-block;
      margin: 20px auto;
      max-width: 360px;
      line-height: 1.6;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    a {
      text-decoration: none;
      color: #007BFF;
    }
  </style>
</head>
<body>

<div id="app"></div>

<script>
  const foodOptions = {
    chinese: [
      "Char Kway Teow", "Hainanese Chicken Rice", "Bak Kut Teh", "Wantan Mee", "Claypot Yee Mee",
      "Pan Mee", "Yong Tau Foo", "Steamed Fish with Soy Sauce", "Sweet and Sour Pork", "Kam Heong Lala",
      "Marmite Chicken", "Egg Foo Young"
    ],
    malay: [
      "Nasi Lemak", "Nasi Kerabu", "Nasi Campur", "Ayam Masak Merah", "Sambal Sotong",
      "Mee Rebus", "Laksa Kedah", "Rendang Daging", "Lontong", "Ikan Bakar",
      "Sup Tulang", "Gulai Ayam"
    ],
    indian: [
      "Banana Leaf Rice", "Roti Canai with Dhal", "Chicken Briyani", "Thosai", "Mutton Curry",
      "Naan with Butter Chicken", "Masala Vadai", "Tandoori Chicken", "Palak Paneer", "Fish Head Curry",
      "Paneer Butter Masala", "Chapati with Kurma"
    ],
    western: [
      "Chicken Chop", "Spaghetti Bolognese", "Lamb Shoulder", "Fish and Chips", "Mac and Cheese",
      "Caesar Salad", "Cheeseburger", "Chicken Carbonara", "Mushroom Soup with Garlic Bread", "Steak with Black Pepper Sauce",
      "Grilled Salmon", "BBQ Ribs"
    ]
  };

  const shuffleDuration = 1500;
  const frameSpeed = 100;

  const hasUsed = localStorage.getItem("hasUsedSuggestion") === "true";

  const app = document.getElementById("app");

  if (hasUsed) {
    // ‚õî Already used ‚Äî block interaction
    app.innerHTML = `
      <h2>üòã You‚Äôve already received your food suggestion!</h2>
      <p>Please scan the QR code again to get a new one.</p>
    `;
  } else {
    // ‚úÖ First-time user ‚Äî show the UI
    app.innerHTML = `
      <h1>üçΩÔ∏è Can't Decide What to Eat?</h1>
      <p>Select a cuisine below and we'll surprise you!</p>
      <select id="cuisineSelect">
        <option value="">-- Choose Cuisine --</option>
        <option value="chinese">Malaysian Chinese</option>
        <option value="malay">Malay</option>
        <option value="indian">Indian</option>
        <option value="western">Western</option>
      </select>
      <br/>
      <button id="go">Get Suggestion!</button>
      <div class="box" id="suggestion"> </div>
    `;

    document.getElementById("go").onclick = () => {
      const cuisine = document.getElementById("cuisineSelect").value;
      const box = document.getElementById("suggestion");
      const btn = document.getElementById("go");

      if (!cuisine) {
        alert("Please select a cuisine first.");
        return;
      }

      const selectedList = foodOptions[cuisine];
      btn.disabled = true;

      // üîí Immediately block future refreshes
      localStorage.setItem("hasUsedSuggestion", "true");

      let tick = 0;
      const interval = setInterval(() => {
        box.textContent = selectedList[tick % selectedList.length];
        tick++;
      }, frameSpeed);

      setTimeout(() => {
        clearInterval(interval);
        const result = selectedList[Math.floor(Math.random() * selectedList.length)];
        const encoded = encodeURIComponent(result + " near me");
        const gmap = `https://www.google.com/maps/search/${encoded}`;

        box.innerHTML = `
          üçΩÔ∏è Try: <strong>${result}</strong><br>
          üìç <a href="${gmap}" target="_blank">See nearby places on Google Maps</a>
        `;

        btn.textContent = "‚úÖ Done";
      }, shuffleDuration);
    };
  }
</script>

</body>
</html>
